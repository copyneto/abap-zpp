sap.ui.define(                                                                                                                                                                                                                                                 
    [                                                                                                                                                                                                                                                          
        "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                           
        "sap/ui/core/util/Export",                                                                                                                                                                                                                             
        "sap/ui/export/library"                                                                                                                                                                                                                                
    ],                                                                                                                                                                                                                                                         
    function (Spreadsheet, Export, exportLibrary, library) {                                                                                                                                                                                                   
        "use strict";                                                                                                                                                                                                                                          
        var EdmType = exportLibrary.EdmType;                                                                                                                                                                                                                   
        return sap.ui.controller("br.com.trescoracoes.zppplanoproducao.ext.controller.ListReportExt", {                                                                                                                                                        
                                                                                                                                                                                                                                                               
            _createColumnConfigCurto: function () {                                                                                                                                                                                                            
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Tipo de Ordem',                                                                                                                                                                                                                 
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Produto',                                                                                                                                                                                                                       
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'FÃ¡brica',                                                                                                                                                                                                                       
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Centro de Planejamento',                                                                                                                                                                                                        
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Quantidade',                                                                                                                                                                                                                    
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Data',                                                                                                                                                                                                                          
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    //property: 'firming_ind',                                                                                                                                                                                                                 
                    property: 'CÃ³digo de fixaÃ§Ã£o',                                                                                                                                                                                                             
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'VersÃ£o',                                                                                                                                                                                                                        
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                return aCols;                                                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _createColumnConfigMedio: function () {                                                                                                                                                                                                            
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Produto',                                                                                                                                                                                                                       
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'FÃ¡brica',                                                                                                                                                                                                                       
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'VersÃ£o',                                                                                                                                                                                                                        
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Ativo',                                                                                                                                                                                                                         
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'PerÃ­odo',                                                                                                                                                                                                                       
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Data',                                                                                                                                                                                                                          
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'Quantidade',                                                                                                                                                                                                                    
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'UM',                                                                                                                                                                                                                            
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'NÂº de sÃ©rie',                                                                                                                                                                                                                   
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    property: 'VersÃ£o de ProduÃ§Ã£o',                                                                                                                                                                                                            
                    type: EdmType.String                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                return aCols;                                                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _downloadTemplate: function (rbCurto, rdMedio) {                                                                                                                                                                                                   
                var aCols, fileName                                                                                                                                                                                                                            
                if (rbCurto) {                                                                                                                                                                                                                                 
                    aCols = this._createColumnConfigCurto();                                                                                                                                                                                                   
                    fileName = 'CARGA_PLAN_SEMANAL.xlsx'                                                                                                                                                                                                       
                } else {                                                                                                                                                                                                                                       
                    aCols = this._createColumnConfigMedio();                                                                                                                                                                                                   
                    fileName = 'CARGA_PLAN_MENSAL.xlsx'                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var oSettings = {                                                                                                                                                                                                                              
                    workbook: { columns: aCols },                                                                                                                                                                                                              
                    dataSource: [''],                                                                                                                                                                                                                          
                    count: 1,                                                                                                                                                                                                                                  
                    fileName: fileName,                                                                                                                                                                                                                        
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                var oSheet = new Spreadsheet(oSettings);                                                                                                                                                                                                       
                oSheet.build().finally(function () {                                                                                                                                                                                                           
                    oSheet.destroy();                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onBaixarLayout: function (oEvent) {                                                                                                                                                                                                                
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria DiÃ¡logo dinÃ¢mico (pop-up)                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                         
                    contentWidth: "300px",                                                                                                                                                                                                                     
                    resizable: true,                                                                                                                                                                                                                           
                    type: "Message"                                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                oUploadDialog.setTitle("Baixar Layout Excel");                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria grid para Radio Button                                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                              
                    width: '100%',                                                                                                                                                                                                                             
                    content: [                                                                                                                                                                                                                                 
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        new sap.m.RadioButtonGroup({                                                                                                                                                                                                           
                            id: "rbg2",                                                                                                                                                                                                                        
                            columns: 2,                                                                                                                                                                                                                        
                            buttons: [                                                                                                                                                                                                                         
                                new sap.m.RadioButton({                                                                                                                                                                                                        
                                    id: "curto",                                                                                                                                                                                                               
                                    text: "Curto Prazo"                                                                                                                                                                                                        
                                }),                                                                                                                                                                                                                            
                                new sap.m.RadioButton({                                                                                                                                                                                                        
                                    id: "medio",                                                                                                                                                                                                               
                                    text: "MÃ©dio Prazo"                                                                                                                                                                                                        
                                })                                                                                                                                                                                                                             
                            ]                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    ]                                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botÃ£o para a carga do arquivo                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    text: 'Baixar',                                                                                                                                                                                                                            
                    type: 'Accept',                                                                                                                                                                                                                            
                    press: function (oEvent) {                                                                                                                                                                                                                 
                        this._downloadTemplate(sap.ui.getCore().getElementById('curto').getSelected(), sap.ui.getCore().getElementById('medio').getSelected())                                                                                                 
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botÃ£o de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                oUploadDialog.addContent(oContent);                                                                                                                                                                                                            
                oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                   
                oUploadDialog.setEndButton(oTriggerButton);                                                                                                                                                                                                    
                oUploadDialog.open();                                                                                                                                                                                                                          
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onUploadExcel: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria DiÃ¡logo dinÃ¢mico (pop-up)                                                                                                                                                                                                                 
                =================================================================== */                                                                                                                                                                         
                var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                         
                    contentWidth: "300px",                                                                                                                                                                                                                     
                    resizable: true,                                                                                                                                                                                                                           
                    type: "Message"                                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                oUploadDialog.setTitle("Carregar arquivo Excel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Define o serviÃ§o gateway que serÃ¡ chamado                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                var sServiceUrl = "/sap/opu/odata/sap/ZPP_PLANO_PRODUCAO_SRV_EX/";                                                                                                                                                                             
                var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, false);                                                                                                                                                                            
                var sSource = sServiceUrl + "excelSet";                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara o responsÃ¡vel pela carga do arquivo                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                    width: "100%",                                                                                                                                                                                                                             
                    fileType: "xlsx",                                                                                                                                                                                                                          
                    style: "Emphasized",                                                                                                                                                                                                                       
                    uploadComplete: function (oEvent) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        // Atualiza tabela do relatÃ³rio apÃ³s carga                                                                                                                                                                                             
                        var sId = this.oView.sId + '--responsiveTable';                                                                                                                                                                                        
                        var oTable = this.byId(sId);                                                                                                                                                                                                           
                        oTable.getModel().refresh(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        // Verifica o retorno da mensagem                                                                                                                                                                                                      
                        if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                              
                            oEvent.mParameters.status == '201') {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            sap.m.MessageToast.show("Carga realizada com sucesso.");                                                                                                                                                                           
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            //if (oEvent.mParameters.response) {                                                                                                                                                                                               
                            //    alert("Return Code: " + oEvent.mParameters.response, "Response", "Response");                                                                                                                                                
                            //}                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                                // Recupera texto da mensagem                                                                                                                                                                                                  
                                let aMessage = [];                                                                                                                                                                                                             
                                for (const res of oEvent.mParameters.responseRaw.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                               
                                    aMessage.push(res[1]);                                                                                                                                                                                                     
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Recupera o tipo da mensagem                                                                                                                                                                                                 
                                let aSeverity = [];                                                                                                                                                                                                            
                                for (const res of oEvent.mParameters.responseRaw.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                             
                                    switch (res[1]) {                                                                                                                                                                                                          
                                        case "error":                                                                                                                                                                                                          
                                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                     
                                            break;                                                                                                                                                                                                             
                                        case "info":                                                                                                                                                                                                           
                                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                               
                                            break;                                                                                                                                                                                                             
                                        case "success":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        case "warning":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        default:                                                                                                                                                                                                               
                                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                      
                                            break;                                                                                                                                                                                                             
                                    }                                                                                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Exibe mensagem                                                                                                                                                                                                              
                                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                    if (aMessage[i] == "Ocorreu uma exceÃ§Ã£o") {                                                                                                                                                                                
                                        continue;                                                                                                                                                                                                              
                                    }                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: aMessage[i],                                                                                                                                                                                                  
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: aSeverity[i]                                                                                                                                                                                                     
                                    }));                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                    alert(aMessage[i]);                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
               Define parÃ¢metros                                                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                      
                oFileUploader.setUploadUrl(sSource);                                                                                                                                                                                                           
                oFileUploader.setSendXHR(true);                                                                                                                                                                                                                
                oFileUploader.setUseMultipart(false);                                                                                                                                                                                                          
                oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                        
                    name: "x-csrf-token",                                                                                                                                                                                                                      
                    value: oModel.getSecurityToken()                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                oFileUploader.insertHeaderParameter(oToken);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botÃ£o para a carga do arquivo                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    text: 'Upload',                                                                                                                                                                                                                            
                    type: 'Accept',                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        // Verifica se arquivo foi informado                                                                                                                                                                                                   
                        var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                           
                        var file = domRef.files[0];                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        if (oFileUploader.getValue() === '') {                                                                                                                                                                                                 
                            sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                            
                            return;                                                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                          
                            name: "Content-Type",                                                                                                                                                                                                              
                            value: file.type                                                                                                                                                                                                                   
                        });                                                                                                                                                                                                                                    
                        oFileUploader.insertHeaderParameter(oContentType);                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        // Recupera o tipo de arquivo: C - Curto, M - MÃ©dio                                                                                                                                                                                    
                        var vType = oTriggerRadioButton.getSelectedButton().mProperties.text[0];                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                         
                            name: "SLUG",                                                                                                                                                                                                                      
                            value: oFileUploader.getValue() + ";" + vType                                                                                                                                                                                      
                        }));                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oFileUploader.upload();                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botÃ£o de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria radio-button                                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                var oTriggerRadioButton = new sap.m.RadioButtonGroup({                                                                                                                                                                                         
                    columns: 2,                                                                                                                                                                                                                                
                    width: "100%",                                                                                                                                                                                                                             
                    buttons: [                                                                                                                                                                                                                                 
                        new sap.m.RadioButton({                                                                                                                                                                                                                
                            text: "Curto Prazo"                                                                                                                                                                                                                
                        }),                                                                                                                                                                                                                                    
                        new sap.m.RadioButton({                                                                                                                                                                                                                
                            text: "MÃ©dio Prazo"                                                                                                                                                                                                                
                        })],                                                                                                                                                                                                                                   
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama diÃ¡logo com a lÃ³gica de carga&nbsp;                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                       
                oUploadDialog.addContent(oTriggerRadioButton);                                                                                                                                                                                                 
                oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                   
                oUploadDialog.setEndButton(oTriggerButton);                                                                                                                                                                                                    
                oUploadDialog.open();                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionDownload: function (oEvent) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupera linha primeira linha selecionada                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica as linhas selecionadas                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                if (!oItems.length) {                                                                                                                                                                                                                          
                    sap.m.MessageToast.show("Nenhum registro selecionado.");                                                                                                                                                                                   
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (oItems.length > 1) {                                                                                                                                                                                                                       
                    alert("Favor selecionar apenas um registro");                                                                                                                                                                                              
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara serviÃ§o                                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                var vServiceUrl = "/sap/opu/odata/sap/ZPP_PLANO_PRODUCAO_SRV_EX/";                                                                                                                                                                             
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                var vEntitySet = "downloadSet(Id='" + oItems[0].getObject().Id + "')/$value";                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModel.read(vEntitySet, {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                showSuccessMessage();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(oResponse.requestUri, true);                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                showErrorMessage();                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                // Recupera texto da mensagem                                                                                                                                                                                                  
                                let aMessage = [];                                                                                                                                                                                                             
                                for (const res of oError.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                         
                                    aMessage.push(res[1]);                                                                                                                                                                                                     
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Recupera o tipo da mensagem                                                                                                                                                                                                 
                                let aSeverity = [];                                                                                                                                                                                                            
                                for (const res of oError.response.body.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                       
                                    switch (res[1]) {                                                                                                                                                                                                          
                                        case "error":                                                                                                                                                                                                          
                                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                     
                                            break;                                                                                                                                                                                                             
                                        case "info":                                                                                                                                                                                                           
                                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                               
                                            break;                                                                                                                                                                                                             
                                        case "success":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        case "warning":                                                                                                                                                                                                        
                                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                   
                                            break;                                                                                                                                                                                                             
                                        default:                                                                                                                                                                                                               
                                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                      
                                            break;                                                                                                                                                                                                             
                                    }                                                                                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                // Exibe mensagem                                                                                                                                                                                                              
                                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                    if (aMessage[i] == "Ocorreu uma exceÃ§Ã£o") {                                                                                                                                                                                
                                        continue;                                                                                                                                                                                                              
                                    }                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                         
                                        message: aMessage[i],                                                                                                                                                                                                  
                                        persistent: true, // create message as transition message                                                                                                                                                              
                                        type: aSeverity[i]                                                                                                                                                                                                     
                                    }));                                                                                                                                                                                                                       
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura pop-up de mensagens                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                                 
                    {                                                                                                                                                                                                                                          
                        busy: {                                                                                                                                                                                                                                
                            set: true,                                                                                                                                                                                                                         
                            check: false                                                                                                                                                                                                                       
                        },                                                                                                                                                                                                                                     
                        sActionLabel: "Mensagens"                                                                                                                                                                                                              
                    });                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showSuccessMessage: function (sMessage) {                                                                                                                                                                                                          
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showErrorMessage: function (sMessage) {                                                                                                                                                                                                            
                this.getView().setBusy(false);                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               